<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DStack VPN Monitoring</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin: 0;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-card h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background-color: #4CAF50; }
        .status-unhealthy { background-color: #f44336; }
        .status-unknown { background-color: #ff9800; }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .metric {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background: #0056b3;
        }
        .log-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            font-family: monospace;
            font-size: 12px;
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        .log-info { background: #e3f2fd; }
        .log-error { background: #ffebee; }
        .log-warning { background: #fff3e0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DStack VPN Monitoring Dashboard</h1>
            <p>Real-time status and metrics for VPN nodes</p>
        </div>

        <button class="refresh-btn" onclick="refreshData()">Refresh Data</button>

        <div class="status-grid">
            <div class="status-card">
                <h3>Node A Status</h3>
                <div id="node-a-status">
                    <span class="status-indicator status-unknown"></span>
                    <span>Checking...</span>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="node-a-peers">-</div>
                        <div class="metric-label">Active Peers</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="node-a-uptime">-</div>
                        <div class="metric-label">Uptime</div>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <h3>Node B Status</h3>
                <div id="node-b-status">
                    <span class="status-indicator status-unknown"></span>
                    <span>Checking...</span>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="node-b-peers">-</div>
                        <div class="metric-label">Active Peers</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="node-b-uptime">-</div>
                        <div class="metric-label">Uptime</div>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <h3>Network Status</h3>
                <div id="network-status">
                    <span class="status-indicator status-unknown"></span>
                    <span>Checking...</span>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="total-peers">-</div>
                        <div class="metric-label">Total Peers</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="connectivity">-</div>
                        <div class="metric-label">Connectivity</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="log-container">
            <h3>Recent Activity</h3>
            <div id="log-entries">
                <div class="log-entry log-info">Loading logs...</div>
            </div>
        </div>
    </div>

    <script>
        const NODES = [
            { name: 'node-a', port: 8080 },
            { name: 'node-b', port: 8081 }
        ];

        function formatUptime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}d ${hours % 24}h`;
            if (hours > 0) return `${hours}h ${minutes % 60}m`;
            if (minutes > 0) return `${minutes}m ${seconds % 60}s`;
            return `${seconds}s`;
        }

        function updateNodeStatus(nodeName, port) {
            fetch(`http://localhost:${port}/health`)
                .then(response => response.json())
                .then(data => {
                    const statusElement = document.getElementById(`${nodeName}-status`);
                    const peersElement = document.getElementById(`${nodeName}-peers`);
                    const uptimeElement = document.getElementById(`${nodeName}-uptime`);
                    
                    const indicator = statusElement.querySelector('.status-indicator');
                    const text = statusElement.querySelector('span:last-child');
                    
                    if (data.status === 'healthy') {
                        indicator.className = 'status-indicator status-healthy';
                        text.textContent = 'Healthy';
                    } else {
                        indicator.className = 'status-indicator status-unhealthy';
                        text.textContent = 'Unhealthy';
                    }
                    
                    if (data.bridge && data.bridge.uptime) {
                        uptimeElement.textContent = formatUptime(data.bridge.uptime);
                    }
                    
                    if (data.peerRegistry && data.peerRegistry.activePeers) {
                        peersElement.textContent = data.peerRegistry.activePeers;
                    }
                    
                    addLogEntry(`${nodeName} health check: ${data.status}`, 'info');
                })
                .catch(error => {
                    const statusElement = document.getElementById(`${nodeName}-status`);
                    const indicator = statusElement.querySelector('.status-indicator');
                    const text = statusElement.querySelector('span:last-child');
                    
                    indicator.className = 'status-indicator status-unhealthy';
                    text.textContent = 'Unreachable';
                    
                    addLogEntry(`${nodeName} health check failed: ${error.message}`, 'error');
                });
        }

        function updateNetworkStatus() {
            Promise.all(NODES.map(node => 
                fetch(`http://localhost:${node.port}/health`)
                    .then(response => response.json())
                    .catch(() => ({ status: 'unhealthy' }))
            )).then(results => {
                const healthyNodes = results.filter(r => r.status === 'healthy').length;
                const totalNodes = NODES.length;
                
                const statusElement = document.getElementById('network-status');
                const indicator = statusElement.querySelector('.status-indicator');
                const text = statusElement.querySelector('span:last-child');
                
                if (healthyNodes === totalNodes) {
                    indicator.className = 'status-indicator status-healthy';
                    text.textContent = 'All Nodes Healthy';
                } else if (healthyNodes > 0) {
                    indicator.className = 'status-indicator status-warning';
                    text.textContent = `${healthyNodes}/${totalNodes} Nodes Healthy`;
                } else {
                    indicator.className = 'status-indicator status-unhealthy';
                    text.textContent = 'All Nodes Unhealthy';
                }
                
                document.getElementById('total-peers').textContent = 
                    results.reduce((sum, r) => sum + (r.peerRegistry?.activePeers || 0), 0);
                document.getElementById('connectivity').textContent = 
                    `${Math.round((healthyNodes / totalNodes) * 100)}%`;
            });
        }

        function addLogEntry(message, level = 'info') {
            const logContainer = document.getElementById('log-entries');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${level}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logContainer.insertBefore(entry, logContainer.firstChild);
            
            // Keep only last 50 entries
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        function refreshData() {
            addLogEntry('Refreshing data...', 'info');
            
            NODES.forEach(node => {
                updateNodeStatus(node.name, node.port);
            });
            
            updateNetworkStatus();
        }

        // Initial load
        refreshData();
        
        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);
        
        // Add initial log entry
        addLogEntry('Monitoring dashboard started', 'info');
    </script>
</body>
</html> 